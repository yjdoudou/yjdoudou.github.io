<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>IDEA-docker远程部署及调试springboot</title>
    <url>/2020/07/17/56061/</url>
    <content><![CDATA[<!-- build time:Sat Jul 18 2020 13:38:02 GMT+0800 (GMT+08:00) --><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="配置docker的远程端口"><a href="#配置docker的远程端口" class="headerlink" title="配置docker的远程端口"></a>配置docker的远程端口</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 修改docker.service支持远程访问</span></span><br><span class="line">vim /usr/lib/systemd/system/docker.service</span><br><span class="line"><span class="meta">#</span><span class="bash"> ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span></span><br><span class="line">ExecStart=/usr/bin/dockerd -H tcp://0.0.0.0:9527 -H unix:///var/run/docker.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> 通知docker服务做出的修改</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="IDEA连接远程服务器Docker"><a href="#IDEA连接远程服务器Docker" class="headerlink" title="IDEA连接远程服务器Docker"></a>IDEA连接远程服务器Docker</h2><p>idea，settings搜索docker,没有请先安装docker插件。</p><p><img src="/2020/07/17/56061/1.png" alt="1594951904"></p><p>显示docker images及container</p><p><img src="/2020/07/17/56061/2.png" alt="1594951904"></p><h2 id="远程部署服务"><a href="#远程部署服务" class="headerlink" title="远程部署服务"></a>远程部署服务</h2><p>在src/main下新建docker文件夹，新建Dockerfile文件</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zyj &lt;<span class="number">1769072244</span>@qq.com&gt;</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> railway-platform-1.0.0-release.jar app.jar</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> bash -c <span class="string">'touch /app.jar'</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8085</span> <span class="number">11005</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>,<span class="string">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="string">"-jar"</span>,<span class="string">"/app.jar"</span>]</span></span><br><span class="line"><span class="comment">#ENTRYPOINT ["java","-Djava.security.egd=file:/dev/./urandom","-jar","-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=11005","/app.jar"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br></pre></td></tr></table></figure><p>maven打包，将jar包放置在src/main/docker文件夹内,配置dockerfile启动，Dockerfile选择新建的Dockerfile文件。</p><p><img src="/2020/07/17/56061/3.png" alt="1594951904"></p><p>最后运行docker，会构建镜像及启动容器。</p><h1 id="远程调试"><a href="#远程调试" class="headerlink" title="远程调试"></a>远程调试</h1><p><img src="/2020/07/17/56061/4.png" alt="1594951904"></p><p>添加Remote，host填写服务器ip，port填写监听端口，复制</p><p><code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=11005</code></p><p>到Dockerfile文件中</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> zyj &lt;<span class="number">1769072244</span>@qq.com&gt;</span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> /tmp</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> railway-platform-1.0.0-release.jar app.jar</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> bash -c <span class="string">'touch /app.jar'</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8085</span> <span class="number">11005</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"java"</span>,<span class="string">"-Djava.security.egd=file:/dev/./urandom"</span>,<span class="string">"-jar"</span>,<span class="string">"-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=11005"</span>,<span class="string">"/app.jar"</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br></pre></td></tr></table></figure><p>点击下方+号，添加Dockerfile文件。debug启动，结束。</p><p><img src="/2020/07/17/56061/5.png" alt="1594951904"></p><!-- rebuild by neat -->]]></content>
      <categories>
        <category>CI/CD</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
</search>
